const toolbarIcon = `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid meet" viewBox="0 0 65 65" width="65" height="65"><defs><path d="M19.19 49.15L32.11 18.7" id="b2ppkTWgqu"></path><path d="M17.27 12.86C18.28 10.46 19.99 9.77 22.39 10.79C30.68 14.31 35.29 16.27 36.21 16.66C38.6 17.68 39.29 19.38 38.28 21.78C30.54 40 26.25 50.12 25.39 52.14C24.37 54.54 22.67 55.23 20.27 54.21C11.98 50.69 7.37 48.73 6.45 48.34C4.05 47.32 3.36 45.62 4.38 43.22C12.11 25 16.41 14.88 17.27 12.86Z" id="a1S96GLwMR"></path><path d="M36.92 15.32C38.97 13.71 40.8 13.94 42.4 15.99C47.95 23.09 51.03 27.03 51.65 27.82C53.25 29.87 53.02 31.7 50.97 33.3C35.38 45.49 26.71 52.25 24.98 53.61C22.93 55.21 21.1 54.99 19.5 52.94C13.95 45.84 10.87 41.89 10.26 41.1C8.65 39.05 8.88 37.22 10.93 35.62C26.52 23.44 35.19 16.67 36.92 15.32Z" id="m77QZZ1sfB"></path><path d="M21.01 47.99L47.07 27.63" id="d183X3cOVJ"></path><path d="M57.17 31.84C59.77 31.84 61.08 33.14 61.08 35.74C61.08 44.75 61.08 49.76 61.08 50.76C61.08 53.36 59.77 54.66 57.17 54.66C37.38 54.66 26.39 54.66 24.19 54.66C21.59 54.66 20.28 53.36 20.28 50.76C20.28 41.75 20.28 36.74 20.28 35.74C20.28 33.14 21.59 31.84 24.19 31.84C43.98 31.84 54.97 31.84 57.17 31.84Z" id="b3f2zhu1R"></path><path d="M56.92 38.28C56.92 39.95 55.56 41.31 53.89 41.31C52.22 41.31 50.86 39.95 50.86 38.28C50.86 36.6 52.22 35.24 53.89 35.24C55.56 35.24 56.92 36.6 56.92 38.28Z" id="a2izy2SnT7"></path><path d="M24.52 47.79L57.59 47.79" id="a25CPUvXmM"></path><path d="M40.69 20.54C41.72 21.86 41.48 23.77 40.16 24.8C38.84 25.83 36.94 25.6 35.91 24.28C34.88 22.96 35.11 21.05 36.43 20.02C37.75 18.99 39.66 19.22 40.69 20.54Z" id="f119ebPdv5"></path><path d="M23.1 15.61C24.64 16.26 25.36 18.04 24.7 19.58C24.05 21.12 22.27 21.84 20.73 21.19C19.18 20.53 18.46 18.75 19.12 17.21C19.77 15.67 21.55 14.95 23.1 15.61Z" id="b48Oe97t6"></path></defs><g><g><g><use xlink:href="#b2ppkTWgqu" opacity="1" fill="#000000" fill-opacity="0"></use><g><use xlink:href="#b2ppkTWgqu" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#a1S96GLwMR" opacity="1" fill="#ffffff" fill-opacity="1"></use><g><use xlink:href="#a1S96GLwMR" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#m77QZZ1sfB" opacity="1" fill="#ffffff" fill-opacity="1"></use><g><use xlink:href="#m77QZZ1sfB" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#d183X3cOVJ" opacity="1" fill="#000000" fill-opacity="0"></use><g><use xlink:href="#d183X3cOVJ" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#b3f2zhu1R" opacity="1" fill="#ffffff" fill-opacity="1"></use><g><use xlink:href="#b3f2zhu1R" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><g><use xlink:href="#a2izy2SnT7" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#a25CPUvXmM" opacity="1" fill="#000000" fill-opacity="0"></use><g><use xlink:href="#a25CPUvXmM" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><g><use xlink:href="#f119ebPdv5" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><g><use xlink:href="#b48Oe97t6" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g></g></g></svg>`

// <?xml version="1.0" encoding="UTF-8" standalone="no"?>
// <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
// <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid meet" viewBox="0 0 65 65" width="65" height="65"><defs><path d="M19.19 49.15L32.11 18.7" id="b2ppkTWgqu"></path><path d="M17.27 12.86C18.28 10.46 19.99 9.77 22.39 10.79C30.68 14.31 35.29 16.27 36.21 16.66C38.6 17.68 39.29 19.38 38.28 21.78C30.54 40 26.25 50.12 25.39 52.14C24.37 54.54 22.67 55.23 20.27 54.21C11.98 50.69 7.37 48.73 6.45 48.34C4.05 47.32 3.36 45.62 4.38 43.22C12.11 25 16.41 14.88 17.27 12.86Z" id="a1S96GLwMR"></path><path d="M36.92 15.32C38.97 13.71 40.8 13.94 42.4 15.99C47.95 23.09 51.03 27.03 51.65 27.82C53.25 29.87 53.02 31.7 50.97 33.3C35.38 45.49 26.71 52.25 24.98 53.61C22.93 55.21 21.1 54.99 19.5 52.94C13.95 45.84 10.87 41.89 10.26 41.1C8.65 39.05 8.88 37.22 10.93 35.62C26.52 23.44 35.19 16.67 36.92 15.32Z" id="m77QZZ1sfB"></path><path d="M21.01 47.99L47.07 27.63" id="d183X3cOVJ"></path><path d="M57.17 31.84C59.77 31.84 61.08 33.14 61.08 35.74C61.08 44.75 61.08 49.76 61.08 50.76C61.08 53.36 59.77 54.66 57.17 54.66C37.38 54.66 26.39 54.66 24.19 54.66C21.59 54.66 20.28 53.36 20.28 50.76C20.28 41.75 20.28 36.74 20.28 35.74C20.28 33.14 21.59 31.84 24.19 31.84C43.98 31.84 54.97 31.84 57.17 31.84Z" id="b3f2zhu1R"></path><path d="M56.92 38.28C56.92 39.95 55.56 41.31 53.89 41.31C52.22 41.31 50.86 39.95 50.86 38.28C50.86 36.6 52.22 35.24 53.89 35.24C55.56 35.24 56.92 36.6 56.92 38.28Z" id="a2izy2SnT7"></path><path d="M24.52 47.79L57.59 47.79" id="a25CPUvXmM"></path><path d="M40.69 20.54C41.72 21.86 41.48 23.77 40.16 24.8C38.84 25.83 36.94 25.6 35.91 24.28C34.88 22.96 35.11 21.05 36.43 20.02C37.75 18.99 39.66 19.22 40.69 20.54Z" id="f119ebPdv5"></path><path d="M23.1 15.61C24.64 16.26 25.36 18.04 24.7 19.58C24.05 21.12 22.27 21.84 20.73 21.19C19.18 20.53 18.46 18.75 19.12 17.21C19.77 15.67 21.55 14.95 23.1 15.61Z" id="b48Oe97t6"></path></defs><g><g><g><use xlink:href="#b2ppkTWgqu" opacity="1" fill="#000000" fill-opacity="0"></use><g><use xlink:href="#b2ppkTWgqu" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#a1S96GLwMR" opacity="1" fill="#ffffff" fill-opacity="1"></use><g><use xlink:href="#a1S96GLwMR" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#m77QZZ1sfB" opacity="1" fill="#ffffff" fill-opacity="1"></use><g><use xlink:href="#m77QZZ1sfB" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#d183X3cOVJ" opacity="1" fill="#000000" fill-opacity="0"></use><g><use xlink:href="#d183X3cOVJ" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#b3f2zhu1R" opacity="1" fill="#ffffff" fill-opacity="1"></use><g><use xlink:href="#b3f2zhu1R" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><g><use xlink:href="#a2izy2SnT7" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><use xlink:href="#a25CPUvXmM" opacity="1" fill="#000000" fill-opacity="0"></use><g><use xlink:href="#a25CPUvXmM" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><g><use xlink:href="#f119ebPdv5" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g><g><g><use xlink:href="#b48Oe97t6" opacity="1" fill-opacity="0" stroke="#050038" stroke-width="2" stroke-opacity="1"></use></g></g></g></g></svg>

miro.onReady(async () => {
	miro.currentUser.getId().then(user_id =>
		gtag('set', {'user_id': user_id}))
	miro.initialize({
		extensionPoints: {
      toolbar: {
        title: 'Cards',
        toolbarSvgIcon: toolbarIcon,
        librarySvgIcon: toolbarIcon,
        onClick: () => {
          miro.board.ui.openLibrary('/static/web-plugin/cards_lib', {title: 'Cards library'});
        }
      }
		}
	})
  Object.defineProperty(window, 'team_id', {
      value: (await miro.account.get())['id'],
      configurable: false,
      writable: false
  })
  Object.defineProperty(window, 'user_id', {
      value: await miro.currentUser.getId(),
      configurable: false,
      writable: false
  })
  $.ajax({
      url: '/startSession',
      method: 'GET',
      headers: {
          'Content-Type': 'application/json'
      },
      data: {
          user_id: user_id,
          team_id: team_id
      }
  })
})

window.addEventListener("beforeunload", async function (e) {
  await $.ajax({
    url: '/endSession',
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    },
    data: {
      user_id: user_id,
      team_id: team_id
    }
  })
});